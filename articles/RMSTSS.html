<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>RMSTSS: Sample Size and Power Calculations for RMST-based Clinical Trials • RMSTSS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="RMSTSS: Sample Size and Power Calculations for RMST-based Clinical Trials">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RMSTSS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/RMSTSS.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>RMSTSS: Sample Size and Power Calculations for RMST-based Clinical Trials</h1>
                        <h4 data-toc-skip class="author">Arnab Aich</h4>
            
      

      <div class="d-none name"><code>RMSTSS.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The analysis of time-to-event data often relies on the Cox
proportional hazards model, which uses the hazard ratio (HR) as its
primary result. However, the HR can be difficult to interpret,
especially when its core assumption of proportional hazards is not
met.</p>
<p>As an alternative, the <strong>Restricted Mean Survival Time
(RMST)</strong> is gaining favor for its clarity and robust properties
<span class="citation">(<a href="#ref-royston2013">Royston and Parmar
2013</a>; <a href="#ref-uno2014">Uno et al. 2014</a>)</span>. The RMST
measures the average event-free time up to a pre-specified follow-up
point, <strong>L</strong>. This provides a direct and meaningful measure
of treatment benefit (e.g., “an average of 3 extra months of survival
over 5 years”), which is highly valuable for clinicians and
patients.</p>
<p>Modern statistical methods now focus on modeling the RMST directly as
a function of covariates, rather than estimating it indirectly from a
survival curve. This direct approach, based on foundational work using
Inverse Probability of Censoring Weighting (IPCW) <span class="citation">(<a href="#ref-tian2014">Tian, Zhao, and Wei
2014</a>)</span>, has been extended to handle the complex data
structures seen in modern trials, including stratification <span class="citation">(<a href="#ref-wang2019">Wang et al. 2019</a>; <a href="#ref-zhang2024">Zhang and Schaubel 2024</a>)</span> and competing
risks <span class="citation">(<a href="#ref-wang2018">Wang and Schaubel
2018</a>)</span>.</p>
<p>However, most software tools for these advanced methods focus on
analyzing existing data, not designing new studies. This has left trial
statisticians to write custom code for the crucial task of calculating
sample size and power.</p>
<p>The <code>RMSTSS</code> package is designed to fill this gap. It
provides a comprehensive and user-friendly suite of tools for
<strong>power and sample size calculations</strong> based on the latest
direct RMST methodologies. The package implements several key approaches
from the statistical literature:</p>
<ul>
<li>
<strong>Direct Linear Models</strong>: The foundational IPCW-based
regression model for RMST <span class="citation">(<a href="#ref-tian2014">Tian, Zhao, and Wei 2014</a>)</span>.</li>
<li>
<strong>Stratified Models</strong>: Efficient methods for studies
with many strata (e.g., clinical centers), including both
<strong>additive</strong> <span class="citation">(<a href="#ref-zhang2024">Zhang and Schaubel 2024</a>)</span> and
<strong>multiplicative</strong> (<span class="citation">(<a href="#ref-wang2019">Wang et al. 2019</a>)</span>) models.</li>
<li>
<strong>Dependent Censoring Models</strong>: For handling competing
risks, based on methods from <span class="citation">(<a href="#ref-wang2018">Wang and Schaubel 2018</a>)</span>.</li>
<li>
<strong>Flexible Non-Linear Models</strong>: Bootstrap-based
functions using Generalized Additive Models (GAMs) to capture non-linear
covariate effects.</li>
<li>
<strong>Analytic vs. Bootstrap Methods</strong>: For most models,
the package offers a choice between a fast <code>analytical</code>
calculation and a robust, simulation-based <code>boot</code>
method.</li>
</ul>
<p>This vignette will guide you through the theory and application of
each of these function groups.</p>
<hr>
</div>
<div class="section level2">
<h2 class="tabset" id="core-concepts-of-rmstss-package">Core Concepts of <code>RMSTSS</code> Package<a class="anchor" aria-label="anchor" href="#core-concepts-of-rmstss-package"></a>
</h2>
<p>The <code>RMSTSS</code> package uses two primary approaches for its
calculations: a fast <strong>Analytic Method</strong> and a robust
<strong>Bootstrap Method</strong>. All functions for finding sample size
then use a common search algorithm. Understanding these three components
is key to choosing the right function for your needs.</p>
<div class="section level3">
<h3 id="the-analytic-method--analytical-functions">The Analytic Method (<code>.analytical</code> functions)<a class="anchor" aria-label="anchor" href="#the-analytic-method--analytical-functions"></a>
</h3>
<p>The analytical functions are extremely fast because they use a direct
mathematical formula to calculate power. This makes them ideal for
quickly exploring different scenarios. The process is:</p>
<ol style="list-style-type: decimal">
<li>
<strong>One-Time Estimation</strong>: The function first analyzes
the provided <code>pilot_data</code> to estimate two key parameters:
<ul>
<li>The <strong>treatment effect size</strong> (e.g., the difference in
RMST or the log-RMST ratio).</li>
<li>The <strong>asymptotic variance</strong> of that effect estimator,
which measures its uncertainty.</li>
</ul>
</li>
<li>
<strong>Power Formula</strong>: It then plugs these fixed estimates
into a standard power formula. For a given total sample size
<code>N</code>, the power is calculated as:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Power</mtext><mo>=</mo><mi>Φ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>β</mi><mtext mathvariant="normal">effect</mtext></msub><mo stretchy="true" form="postfix">|</mo></mrow><msub><mi>σ</mi><mi>N</mi></msub></mfrac><mo>−</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\text{Power} = \Phi\left( \frac{|\beta_{\text{effect}}|}{\sigma_N} - z_{1-\alpha/2} \right)
</annotation></semantics></math> where:
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Φ</mi><annotation encoding="application/x-tex">\Phi</annotation></semantics></math>
is the cumulative distribution function (CDF) of the standard normal
distribution.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mtext mathvariant="normal">effect</mtext></msub><annotation encoding="application/x-tex">\beta_{\text{effect}}</annotation></semantics></math>
is the treatment effect estimated from the pilot data.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>N</mi></msub><mo>=</mo><mfrac><msub><mi>σ</mi><mn>1</mn></msub><msqrt><mi>N</mi></msqrt></mfrac></mrow><annotation encoding="application/x-tex">\sigma_N = \frac{\sigma_1}{\sqrt{N}}</annotation></semantics></math>
is the standard error of the effect for the target sample size
<code>N</code>, which is scaled from the pilot data’s variance.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><annotation encoding="application/x-tex">z_{1-\alpha/2}</annotation></semantics></math>
is the critical value from the standard normal distribution (e.g., 1.96
for an alpha of 0.05).</li>
</ul>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="the-bootstrap-method--boot-functions">The Bootstrap Method (<code>.boot</code> functions)<a class="anchor" aria-label="anchor" href="#the-bootstrap-method--boot-functions"></a>
</h3>
<p>The bootstrap functions provide a robust, simulation-based
alternative that makes fewer assumptions about the data’s distribution.
This is a trade-off, as they are much more computationally intensive.
The process is:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Resample</strong>: The function simulates a “future trial”
of a given <code>sample_size</code> by resampling with replacement from
the <code>pilot_data</code>.</li>
<li>
<strong>Fit Model</strong>: On this new bootstrap sample, it
performs the full analysis (e.g., calculating weights or
pseudo-observations and fitting the specified model).</li>
<li>
<strong>Get P-Value</strong>: It extracts the p-value for the
treatment effect from the fitted model.</li>
<li>
<strong>Repeat</strong>: This process is repeated thousands of times
(<code>n_sim</code>).</li>
<li>
<strong>Calculate Power</strong>: The final estimated power is the
proportion of simulations where the p-value was less than the
significance level <code>alpha</code>.
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Power</mtext><mo>=</mo><mfrac><mrow><mrow><mtext mathvariant="normal">Number of simulations with </mtext><mspace width="0.333em"></mspace></mrow><mi>p</mi><mo>&lt;</mo><mi>α</mi></mrow><msub><mi>n</mi><mtext mathvariant="normal">sim</mtext></msub></mfrac></mrow><annotation encoding="application/x-tex">
 \text{Power} = \frac{\text{Number of simulations with } p &lt; \alpha}{n_{\text{sim}}}
</annotation></semantics></math>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="the-sample-size-search-algorithm--ss-functions">The Sample Size Search Algorithm (<code>.ss</code> functions)<a class="anchor" aria-label="anchor" href="#the-sample-size-search-algorithm--ss-functions"></a>
</h3>
<p>All functions ending in <code>.ss</code> (for sample size) use the
same iterative search algorithm to find the <code>N</code> required to
achieve a <code>target_power</code>:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Start</strong>: The search begins with a sample size of
<code>n_start</code>.</li>
<li>
<strong>Calculate Power</strong>: It calculates the power for the
<code>current_n</code> using either the <strong>analytic
formula</strong> or a <strong>full bootstrap simulation</strong>.</li>
<li>
<strong>Check Condition</strong>:
<ul>
<li>If <code>calculated_power &gt;= target_power</code>, the search
succeeds and returns <code>current_n</code>.</li>
<li>If not, it increments the sample size
(<code>current_n = current_n + n_step</code>) and repeats the
process.</li>
</ul>
</li>
<li>
<strong>Stopping Rules</strong>: The search terminates if the sample
size exceeds <code>max_n_per_arm</code> or, for bootstrap methods, if
the power fails to improve for a set number of <code>patience</code>
steps.</li>
</ol>
</div>
<div class="section level3">
<h3 id="avaailable-functions-a-quick-guide">Avaailable Functions: A Quick Guide<a class="anchor" aria-label="anchor" href="#avaailable-functions-a-quick-guide"></a>
</h3>
<p>The package uses a consistent naming convention to help you select
the correct function. The names are combinations of the
<code>[Model Type]</code>, the <code>[Goal - power or ss]</code>, and
the <code>[Method - analytical or boot]</code>. The table below provides
a summary of the available functions for each model.</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="left">Model Type</th>
<th align="left">Analytic Functions</th>
<th align="left">Bootstrap Functions</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Linear IPCW</strong></td>
<td align="left">
<code>linear.power.analytical</code>
<br><code>linear.ss.analytical</code>
</td>
<td align="left">
<code>linear.power.boot</code>
<br><code>linear.ss.boot</code>
</td>
</tr>
<tr class="even">
<td align="left"><strong>Additive Stratified</strong></td>
<td align="left">
<code>additive.power.analytical</code>
<br><code>additive.ss.analytical</code>
</td>
<td align="left"><em>Not applicable</em></td>
</tr>
<tr class="odd">
<td align="left"><strong>Multiplicative Stratified</strong></td>
<td align="left">
<code>MS.power.analytical</code>
<br><code>MS.ss.analytical</code>
</td>
<td align="left">
<code>MS.power.boot</code>
<br><code>MS.ss.boot</code>
</td>
</tr>
<tr class="even">
<td align="left"><strong>Semiparametric GAM</strong></td>
<td align="left"><em>Not applicable</em></td>
<td align="left">
<code>GAM.power.boot</code>
<br><code>GAM.ss.boot</code>
</td>
</tr>
<tr class="odd">
<td align="left"><strong>Dependent Censoring</strong></td>
<td align="left">
<code>DC.power.analytical</code>
<br><code>DC.ss.analytical</code>
</td>
<td align="left"><em>Not applicable</em></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="selecting-an-appropriate-model">Selecting an Appropriate Model<a class="anchor" aria-label="anchor" href="#selecting-an-appropriate-model"></a>
</h3>
<p>Model selection depends on the assumptions made about the data
structure and the design of the study. The following table summarizes
recommended modeling strategies under various analytical scenarios:</p>
<table class="table">
<colgroup>
<col width="11%">
<col width="28%">
<col width="60%">
</colgroup>
<thead><tr class="header">
<th align="left">Model</th>
<th align="left">Key Assumption / Scenario</th>
<th align="left">Recommended Use Case</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Linear IPCW</strong></td>
<td align="left">Assumes a linear relationship between covariates and
RMST.</td>
<td align="left">Suitable for baseline analyses where there is no strong
evidence of non-linear effects or complex stratification.</td>
</tr>
<tr class="even">
<td align="left"><strong>Additive Stratified</strong></td>
<td align="left">Assumes the treatment adds a constant amount of
survival time across strata.</td>
<td align="left">Appropriate for multi-center trials where the treatment
effect is expected to be uniform (e.g., a fixed increase in survival
time across centers).</td>
</tr>
<tr class="odd">
<td align="left"><strong>Multiplicative Stratified</strong></td>
<td align="left">Assumes the treatment multiplies survival time
proportionally across strata.</td>
<td align="left">Preferred in multi-center trials where the treatment is
expected to produce proportional gains relative to baseline survival
across different centers.</td>
</tr>
<tr class="even">
<td align="left"><strong>Semiparametric GAM</strong></td>
<td align="left">Allows for non-linear covariate effects on RMST.</td>
<td align="left">Useful when variables (e.g., age, biomarker levels) are
believed to have complex, non-linear associations with the outcome.</td>
</tr>
<tr class="odd">
<td align="left"><strong>Dependent Censoring</strong></td>
<td align="left">Accounts for dependent censoring or competing
risks.</td>
<td align="left">Recommended for studies involving competing events,
such as transplant studies where receiving a transplant precludes
observation of pre-transplant mortality.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 class="tabset" id="linear-ipcw-models">Linear IPCW Models<a class="anchor" aria-label="anchor" href="#linear-ipcw-models"></a>
</h2>
<p>These functions implement the foundational direct linear regression
model for the RMST. This model is appropriate when a linear relationship
between covariates and the RMST is assumed, and when censoring is
independent of the event of interest.</p>
<div class="section level3">
<h3 id="theory-and-model">Theory and Model<a class="anchor" aria-label="anchor" href="#theory-and-model"></a>
</h3>
<p>Based on the methods of <span class="citation">(<a href="#ref-tian2014">Tian, Zhao, and Wei 2014</a>)</span>, these
functions model the conditional RMST as a linear function of covariates:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">[</mo><mo>min</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>T</mi><mi>i</mi></msub><mo>,</mo><mi>L</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="prefix">|</mo><msub><mi>Z</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><msub><mi>β</mi><mn>0</mn></msub><mo>+</mo><msub><mi>β</mi><mn>1</mn></msub><msub><mtext mathvariant="normal">Treatment</mtext><mi>i</mi></msub><mo>+</mo><msub><mi>β</mi><mn>2</mn></msub><msub><mtext mathvariant="normal">Covariate</mtext><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\mathbb{E}[\min(T_i, L) | Z_i] = \beta_0 + \beta_1 \text{Treatment}_i + \beta_2 \text{Covariate}_{i}</annotation></semantics></math>
In this model, the expected RMST up to a pre-specified time
<strong>L</strong> for subject <em>i</em> is modeled as a linear
combination of their treatment arm and other variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Z_i</annotation></semantics></math>.</p>
<p>To handle right-censoring, the method uses <strong>Inverse
Probability of Censoring Weighting (IPCW)</strong>. This is achieved
through the following steps:</p>
<ol style="list-style-type: decimal">
<li>A survival curve for the <strong>censoring distribution</strong> is
estimated using the Kaplan-Meier method (where “failure” is being
censored).</li>
<li>For each subject who experienced the primary event, a weight is
calculated. This weight is the inverse of the probability of
<em>not</em> being censored up to their event time.</li>
<li>A standard weighted linear model (<code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>) is then fitted
using these weights. The model only includes subjects who experienced
the event.</li>
</ol>
</div>
<div class="section level3">
<h3 id="analytical-methods">Analytical Methods<a class="anchor" aria-label="anchor" href="#analytical-methods"></a>
</h3>
<p>The analytical functions use a formula based on the asymptotic
variance of the regression coefficients to calculate power or sample
size, making them extremely fast.</p>
<p><strong>Scenario</strong>: We use the <code>veteran</code> dataset to
estimate power for a trial comparing standard vs. test chemotherapy
(<code>trt</code>), adjusting for the Karnofsky performance score
(<code>karno</code>).</p>
<div class="section level4">
<h4 id="power-calculation---linear-power-analytical">Power Calculation - <a href="../reference/linear.power.analytical.html"><code>linear.power.analytical</code></a><a class="anchor" aria-label="anchor" href="#power-calculation---linear-power-analytical"></a>
</h4>
<p>First, lets inspect the prepared <code>veteran</code> dataset.</p>
<p>Now, we calculate the power for a range of sample sizes using a
truncation time of 9 months (270 days).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_results_vet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linear.power.analytical.html">linear.power.analytical</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">vet</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  linear_terms <span class="op">=</span> <span class="st">"karno"</span>,</span>
<span>  sample_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">150</span>, <span class="fl">200</span>, <span class="fl">250</span><span class="op">)</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">270</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The results are returned as a data frame and a <code>ggplot</code>
object.</p>
</div>
<div class="section level4">
<h4 id="sample-size-calculation---linear-ss-analytical">Sample Size Calculation - <a href="../reference/linear.ss.analytical.html"><code>linear.ss.analytical</code></a><a class="anchor" aria-label="anchor" href="#sample-size-calculation---linear-ss-analytical"></a>
</h4>
<p>We can also use the analytical method to find the required sample
size to achieve a target power for a truncation time of one year (365
days).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss_results_vet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linear.ss.analytical.html">linear.ss.analytical</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">vet</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.40</span>,</span>
<span>  linear_terms <span class="op">=</span> <span class="st">"karno"</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  n_start <span class="op">=</span> <span class="fl">1000</span>, n_step <span class="op">=</span> <span class="fl">250</span>, max_n_per_arm <span class="op">=</span> <span class="fl">5000</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="bootstrap-methods">Bootstrap Methods<a class="anchor" aria-label="anchor" href="#bootstrap-methods"></a>
</h3>
<p>The <code>.boot</code> suffix in function names indicates a
bootstrap, or simulation-based, approach, which provides a robust,
distribution-free alternative. This method repeatedly resamples from the
pilot data, fits the model on each sample, and calculates power as the
proportion of simulations where the treatment effect is significant.
While computationally intensive, it makes fewer assumptions.</p>
<div class="section level4">
<h4 id="power-and-sample-size-calculation--boot">Power and Sample Size Calculation (<code>.boot</code>)<a class="anchor" aria-label="anchor" href="#power-and-sample-size-calculation--boot"></a>
</h4>
<p>Here is how you would call the bootstrap functions for power for the
linear model. The following examples use the same <code>veteran</code>
dataset, but with a smaller number of simulations for demonstration
purposes. In practice, a larger number of simulations (e.g., 1,000 or
more) is recommended to ensure stable results.</p>
<p>First we calculate the power for a range of sample sizes. The <a href="../reference/linear.power.boot.html"><code>linear.power.boot</code></a>
function takes the pilot data and returns a data frame with the
estimated power for each sample size.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_boot_vet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linear.power.boot.html">linear.power.boot</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">vet</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  linear_terms <span class="op">=</span> <span class="st">"karno"</span>,</span>
<span>  sample_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">200</span>, <span class="fl">250</span><span class="op">)</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">200</span> </span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here is how you would call the bootstrap function for sample size
calculation. We will use the function <a href="../reference/linear.ss.boot.html"><code>linear.ss.boot</code></a>
to find the sample size needed to achieve a target power of 0.5,
truncating at 180 days (6 months).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss_boot_vet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linear.ss.boot.html">linear.ss.boot</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">vet</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  linear_terms <span class="op">=</span> <span class="st">"karno"</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">180</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span>, </span>
<span>  patience <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 class="tabset" id="additive-stratified-models">Additive Stratified Models<a class="anchor" aria-label="anchor" href="#additive-stratified-models"></a>
</h2>
<p>In multi-center clinical trials, it is often necessary to stratify
the analysis by a categorical variable with many levels, such as the
clinical center or a discretized biomarker. Estimating a separate
parameter for each stratum can be inefficient, particularly when the
number of strata is large. The additive stratified model elegantly
handles this situation by conditioning out the stratum-specific
effects.</p>
<div class="section level3">
<h3 id="theory-and-model-1">Theory and Model<a class="anchor" aria-label="anchor" href="#theory-and-model-1"></a>
</h3>
<p>The semiparametric additive model for RMST, as developed by <span class="citation">(<a href="#ref-zhang2024">Zhang and Schaubel
2024</a>)</span>, is defined as:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>μ</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><mo>+</mo><mi>β</mi><mi>′</mi><msub><mi>Z</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\mu_{ij} = \mu_{0j} + \beta'Z_i</annotation></semantics></math>
This model assumes that the effect of the covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Z_i</annotation></semantics></math>
(which includes the treatment arm) is <strong>additive</strong> and
constant across all strata
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>.
Crucially, it allows each stratum to have its own unique baseline RMST,
denoted by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{0j}</annotation></semantics></math>.</p>
<p>The estimation of the common treatment effect,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>,
is achieved efficiently through a <strong>stratum-centering</strong>
approach applied to IPCW-weighted data. This method avoids the direct
estimation of the numerous
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{0j}</annotation></semantics></math>
parameters, making it computationally efficient even with a large number
of strata.</p>
</div>
<div class="section level3">
<h3 id="analytical-methods-1">Analytical Methods<a class="anchor" aria-label="anchor" href="#analytical-methods-1"></a>
</h3>
<div class="section level4">
<h4 id="sample-size-calculation---additive-ss-analytical">Sample Size Calculation - <a href="../reference/additive.ss.analytical.html"><code>additive.ss.analytical</code></a><a class="anchor" aria-label="anchor" href="#sample-size-calculation---additive-ss-analytical"></a>
</h4>
<p><strong>Scenario</strong>: We use the <code>colon</code> dataset to
design a trial stratified by the extent of local disease
(<code>extent</code>), a factor with 4 levels. We want to find the
sample size per stratum to achieve 80% power. Lets inspect the prepared
<code>colon</code> dataset.</p>
<p>Now, we run the sample size search for 80% power, truncating at 5
years (1825 days).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss_results_colon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/additive.ss.analytical.html">additive.ss.analytical</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">colon_death</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>, status_var <span class="op">=</span> <span class="st">"status"</span>, arm_var <span class="op">=</span> <span class="st">"arm"</span>, strata_var <span class="op">=</span> <span class="st">"strata"</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.60</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">1825</span>,</span>
<span>  n_start <span class="op">=</span> <span class="fl">100</span>, n_step <span class="op">=</span> <span class="fl">100</span>, max_n_per_arm <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="power-calculation---additive-power-analytical">Power Calculation - <a href="../reference/additive.power.analytical.html"><code>additive.power.analytical</code></a><a class="anchor" aria-label="anchor" href="#power-calculation---additive-power-analytical"></a>
</h4>
<p>This function calculates the power for a given set of sample sizes in
a stratified additive model. We will use the <code>colon</code> dataset
again for this example.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_results_colon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/additive.power.analytical.html">additive.power.analytical</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">colon_death</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  strata_var <span class="op">=</span> <span class="st">"strata"</span>,</span>
<span>  sample_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">3000</span>, <span class="fl">5000</span><span class="op">)</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">1825</span> <span class="co"># 5 years</span></span>
<span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 class="tabset" id="multiplicative-stratified-models">Multiplicative Stratified Models<a class="anchor" aria-label="anchor" href="#multiplicative-stratified-models"></a>
</h2>
<p>As an alternative to the additive model, the multiplicative model may
be preferred if the treatment is expected to have a relative, or
proportional, effect on the RMST—for example, increasing or decreasing
survival time by a certain percentage.</p>
<div class="section level3">
<h3 id="theory-and-model-2">Theory and Model<a class="anchor" aria-label="anchor" href="#theory-and-model-2"></a>
</h3>
<p>The multiplicative model, based on the work of <span class="citation">(<a href="#ref-wang2019">Wang et al. 2019</a>)</span>,
is defined as:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>μ</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>β</mi><mi>′</mi><msub><mi>Z</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu_{ij} = \mu_{0j} \exp(\beta'Z_i)</annotation></semantics></math>
In this model, the covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Z_i</annotation></semantics></math>
have a <strong>multiplicative</strong> effect on the baseline
stratum-specific RMST,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{0j}</annotation></semantics></math>.
This structure is equivalent to a linear model on the log-RMST.</p>
<p>While the formal estimation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
requires a complex iterative solver, this package uses a practical and
computationally efficient approximation. It fits a weighted log-linear
model (<code>lm(log(Y_rmst) ~ ...)</code>) to the data, which provides
robust estimates for the effect size (the log-RMST ratio) and its
variance.</p>
</div>
<div class="section level3">
<h3 id="analytical-methods-2">Analytical Methods<a class="anchor" aria-label="anchor" href="#analytical-methods-2"></a>
</h3>
<div class="section level4">
<h4 id="power-calculation---ms-power-analytical">Power Calculation - <a href="../reference/MS.power.analytical.html"><code>MS.power.analytical</code></a><a class="anchor" aria-label="anchor" href="#power-calculation---ms-power-analytical"></a>
</h4>
<p>This function calculates the power for various sample sizes using the
analytical method for the multiplicative stratified model.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_ms_analytical</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MS.power.analytical.html">MS.power.analytical</a></span><span class="op">(</span></span>
<span>   pilot_data <span class="op">=</span> <span class="va">colon_death</span>,</span>
<span>   time_var <span class="op">=</span> <span class="st">"time"</span>, status_var <span class="op">=</span> <span class="st">"status"</span>, arm_var <span class="op">=</span> <span class="st">"arm"</span>, strata_var <span class="op">=</span> <span class="st">"strata"</span>,</span>
<span>   sample_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">400</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>   tau <span class="op">=</span> <span class="fl">1825</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sample-size-calculation---ms-ss-analytical">Sample Size Calculation - <a href="../reference/MS.ss.analytical.html"><code>MS.ss.analytical</code></a><a class="anchor" aria-label="anchor" href="#sample-size-calculation---ms-ss-analytical"></a>
</h4>
<p>The following example demonstrates the sample size calculation using
the same model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ms_ss_results_colon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MS.ss.analytical.html">MS.ss.analytical</a></span><span class="op">(</span></span>
<span>   pilot_data <span class="op">=</span> <span class="va">colon_death</span>, time_var <span class="op">=</span> <span class="st">"time"</span>, status_var <span class="op">=</span> <span class="st">"status"</span>, arm_var <span class="op">=</span> <span class="st">"arm"</span>, strata_var <span class="op">=</span> <span class="st">"strata"</span>,</span>
<span>   target_power <span class="op">=</span> <span class="fl">0.6</span>,tau <span class="op">=</span> <span class="fl">1825</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="bootstrap-methods-1">Bootstrap Methods<a class="anchor" aria-label="anchor" href="#bootstrap-methods-1"></a>
</h3>
<p>The bootstrap approach provides a more robust, simulation-based
analysis for the multiplicative model.</p>
<div class="section level4">
<h4 id="power-calculation---ms-power-boot">Power Calculation - <a href="../reference/MS.power.boot.html"><code>MS.power.boot</code></a><a class="anchor" aria-label="anchor" href="#power-calculation---ms-power-boot"></a>
</h4>
<p>The following code demonstrates how to call the
<code>MS.power.boot</code> function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_ms_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MS.power.boot.html">MS.power.boot</a></span><span class="op">(</span></span>
<span>   pilot_data <span class="op">=</span> <span class="va">colon_death</span>,</span>
<span>   time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>   status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>   arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>   strata_var <span class="op">=</span> <span class="st">"strata"</span>,</span>
<span>   sample_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">300</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>   tau <span class="op">=</span> <span class="fl">1825</span>,</span>
<span>   n_sim <span class="op">=</span> <span class="fl">100</span>, </span>
<span>   parallel.cores <span class="op">=</span> <span class="fl">10</span> </span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sample-size-calculation---ms-ss-boot">Sample Size Calculation - <a href="../reference/MS.ss.boot.html"><code>MS.ss.boot</code></a><a class="anchor" aria-label="anchor" href="#sample-size-calculation---ms-ss-boot"></a>
</h4>
<p>Similarly, the sample size can be calculated using bootstrap
simulation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss_ms_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MS.ss.boot.html">MS.ss.boot</a></span><span class="op">(</span></span>
<span>   pilot_data <span class="op">=</span> <span class="va">colon_death</span>,</span>
<span>   time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>   status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>   arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>   strata_var <span class="op">=</span> <span class="st">"strata"</span>, </span>
<span>   target_power <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>   tau <span class="op">=</span> <span class="fl">1825</span>,</span>
<span>   n_sim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>   n_start <span class="op">=</span> <span class="fl">100</span>,</span>
<span>   n_step <span class="op">=</span> <span class="fl">50</span>,</span>
<span>   patience <span class="op">=</span> <span class="fl">4</span>,</span>
<span>   parallel.cores <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 class="tabset" id="semiparametric-gam-models">Semiparametric GAM Models<a class="anchor" aria-label="anchor" href="#semiparametric-gam-models"></a>
</h2>
<p>When a covariate is expected to have a non-linear effect on the
outcome (for example, the effect of age or a biomarker), standard linear
models may be misspecified. Generalized Additive Models (GAMs) provide a
flexible solution by modeling such relationships with smooth
functions.</p>
<div class="section level3">
<h3 id="theory-and-model-3">Theory and Model<a class="anchor" aria-label="anchor" href="#theory-and-model-3"></a>
</h3>
<p>These functions use a bootstrap simulation approach combined with a
GAM. The method involves two main steps:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Jackknife Pseudo-Observations</strong>: The time-to-event
outcome is first converted into <strong>jackknife
pseudo-observations</strong> for the RMST. This technique, explored in
recent statistical literature for RMST estimation <span class="citation">(<a href="#ref-perdry2024"><strong>perdry2024?</strong></a>)</span>, creates
a continuous, uncensored variable that represents each subject’s
contribution to the RMST. This makes the outcome suitable for use in a
standard regression framework.</p></li>
<li><p><strong>GAM Fitting</strong>: A GAM is then fitted to these
pseudo-observations. The model has the form:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mtext mathvariant="normal">pseudo</mtext><mi>i</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><msub><mi>β</mi><mn>0</mn></msub><mo>+</mo><msub><mi>β</mi><mn>1</mn></msub><mo>⋅</mo><msub><mtext mathvariant="normal">Treatment</mtext><mi>i</mi></msub><mo>+</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>q</mi></munderover><msub><mi>f</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mtext mathvariant="normal">Covariate</mtext><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{E}[\text{pseudo}_i] = \beta_0 + \beta_1 \cdot \text{Treatment}_i + \sum_{k=1}^{q} f_k(\text{Covariate}_{ik})</annotation></semantics></math>
Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_k()</annotation></semantics></math>
are the non-linear <strong>smooth functions</strong> (splines) that the
GAM estimates from the data.</p></li>
</ol>
<div class="section level4">
<h4 id="power-calculation-formula-gam-power-boot">Power Calculation Formula (<code>GAM.power.boot</code>)<a class="anchor" aria-label="anchor" href="#power-calculation-formula-gam-power-boot"></a>
</h4>
<p>Because this is a bootstrap method, power is not calculated from a
direct formula but is instead estimated empirically from the
simulations:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Power</mtext><mo>=</mo><mfrac><mn>1</mn><mi>B</mi></mfrac><munderover><mo>∑</mo><mrow><mi>b</mi><mo>=</mo><mn>1</mn></mrow><mi>B</mi></munderover><mi>𝕀</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>b</mi></msub><mo>&lt;</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Power} = \frac{1}{B} \sum_{b=1}^{B} \mathbb{I}(p_b &lt; \alpha)</annotation></semantics></math>
Where:</p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>
is the total number of bootstrap simulations
(<code>n_sim</code>).</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>b</mi></msub><annotation encoding="application/x-tex">p_b</annotation></semantics></math>
is the p-value for the treatment effect in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>-th
simulation.</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝕀</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>⋅</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{I}(\cdot)</annotation></semantics></math>
is the indicator function, which is 1 if the condition is true and 0
otherwise.</p></li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="bootstrap-methods-2">Bootstrap Methods<a class="anchor" aria-label="anchor" href="#bootstrap-methods-2"></a>
</h3>
<div class="section level4">
<h4 id="power-calculation---gam-power-boot">Power Calculation - <a href="../reference/GAM.power.boot.html"><code>GAM.power.boot</code></a><a class="anchor" aria-label="anchor" href="#power-calculation---gam-power-boot"></a>
</h4>
<p><strong>Scenario</strong>: We use the <code>gbsg</code> (German
Breast Cancer Study Group) dataset, suspecting that the progesterone
receptor count (<code>pgr</code>) has a non-linear effect on
recurrence-free survival. Here is a look at the prepared
<code>gbsg</code> data.</p>
<p>The following code shows how to calculate power.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GAM.power.boot.html">GAM.power.boot</a></span><span class="op">(</span></span>
<span>   pilot_data <span class="op">=</span> <span class="va">gbsg_prepared</span>,</span>
<span>   time_var <span class="op">=</span> <span class="st">"rfstime"</span>,</span>
<span>   status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>   arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>   smooth_terms <span class="op">=</span> <span class="st">"pgr"</span>, <span class="co"># Model pgr with a smooth term</span></span>
<span>   sample_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">200</span>, <span class="fl">400</span><span class="op">)</span>,</span>
<span>   tau <span class="op">=</span> <span class="fl">2825</span>, <span class="co"># 5 years</span></span>
<span>   n_sim <span class="op">=</span> <span class="fl">500</span>,</span>
<span>   parallel.cores <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">power_gam</span><span class="op">$</span><span class="va">results_plot</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sample-size-calculation---gam-ss-boot">Sample Size Calculation - <a href="../reference/GAM.ss.boot.html"><code>GAM.ss.boot</code></a><a class="anchor" aria-label="anchor" href="#sample-size-calculation---gam-ss-boot"></a>
</h4>
<p><strong>Scenario</strong>: We want to find the sample size needed to
achieve 80% power for detecting an effect of <code>pgr</code> on
recurrence-free survival.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GAM.ss.boot.html">GAM.ss.boot</a></span><span class="op">(</span></span>
<span>   pilot_data <span class="op">=</span> <span class="va">gbsg_prepared</span>,</span>
<span>   time_var <span class="op">=</span> <span class="st">"rfstime"</span>,</span>
<span>   status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>   arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>   target_power <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>   tau <span class="op">=</span> <span class="fl">182</span>, </span>
<span>   n_sim <span class="op">=</span> <span class="fl">500</span>, </span>
<span>   patience <span class="op">=</span> <span class="fl">5</span>,</span>
<span>   parallel.cores <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="dependent-censoring-models">Dependent Censoring Models<a class="anchor" aria-label="anchor" href="#dependent-censoring-models"></a>
</h2>
<p>In some studies, particularly observational or registry studies,
censoring may not be independent of the event of interest. A classic
example is in transplant medicine, where receiving an organ transplant
removes a patient from being at risk of pre-transplant death. This is a
form of <strong>competing risk</strong>, which can also be viewed as
dependent censoring.</p>
<div class="section level3">
<h3 id="theory-and-model-4">Theory and Model<a class="anchor" aria-label="anchor" href="#theory-and-model-4"></a>
</h3>
<p>The methods from <span class="citation">(<a href="#ref-wang2018">Wang
and Schaubel 2018</a>)</span> address this by extending the IPCW
framework. Instead of a single model for the overall censoring
distribution, <strong>cause-specific Cox models</strong> are fitted for
each of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
sources of censoring (e.g., one model for administrative censoring,
another for the competing event).</p>
<p>The final weight for a subject is then a product of the weights
derived from all censoring causes, calculated as:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>i</mi></msub><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mover><mi>Λ</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">W_i = \exp\left(\sum_{k=1}^{K} \hat{\Lambda}_{k}(Y_i)\right)</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>Λ</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><annotation encoding="application/x-tex">\hat{\Lambda}_{k}</annotation></semantics></math>
is the estimated cumulative hazard for censoring cause <code>k</code>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>i</mi></msub><mo>=</mo><mo>min</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>T</mi><mi>i</mi></msub><mo>,</mo><mi>L</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y_i = \min(T_i, L)</annotation></semantics></math>
is the truncated event time. The final analysis is a weighted linear
regression on the RMST.</p>
<div class="section level4">
<h4 id="power-calculation-formula-dc-power-analytical">Power Calculation Formula (<code>DC.power.analytical</code>)<a class="anchor" aria-label="anchor" href="#power-calculation-formula-dc-power-analytical"></a>
</h4>
<p>Power is calculated analytically using the standard formula:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Power</mtext><mo>=</mo><mi>Φ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>β</mi><mtext mathvariant="normal">effect</mtext></msub><mo stretchy="true" form="postfix">|</mo></mrow><msub><mi>σ</mi><mi>N</mi></msub></mfrac><mo>−</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Power} = \Phi\left( \frac{|\beta_{\text{effect}}|}{\sigma_N} - z_{1-\alpha/2} \right)</annotation></semantics></math>
The key difference in this model is that the variance,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mi>N</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_N^2</annotation></semantics></math>,
is derived from a robust sandwich estimator that properly accounts for
the multiple weighting components from the different cause-specific
hazard models.</p>
</div>
</div>
<div class="section level3">
<h3 id="analytical-methods-3">Analytical Methods<a class="anchor" aria-label="anchor" href="#analytical-methods-3"></a>
</h3>
<p>We will use the <code>mgus2</code> dataset for this scenario.</p>
<div class="section level4">
<h4 id="power-calculation---dc-power-analytical">Power Calculation - <a href="../reference/DC.power.analytical.html"><code>DC.power.analytical</code></a><a class="anchor" aria-label="anchor" href="#power-calculation---dc-power-analytical"></a>
</h4>
<p>This function calculates power for a study with dependent censoring
(competing risks) for a given set of sample sizes.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dc_power_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DC.power.analytical.html">DC.power.analytical</a></span><span class="op">(</span></span>
<span>   pilot_data <span class="op">=</span> <span class="va">mgus_prepared</span>,</span>
<span>   time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>   status_var <span class="op">=</span> <span class="st">"event_primary"</span>,</span>
<span>   arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>   dep_cens_status_var <span class="op">=</span> <span class="st">"event_dependent"</span>,</span>
<span>   sample_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">250</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>   linear_terms <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>   tau <span class="op">=</span> <span class="fl">120</span> <span class="co"># 10 years</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sample-size-calculation---dc-ss-analytical">Sample Size Calculation - <a href="../reference/DC.ss.analytical.html"><code>DC.ss.analytical</code></a><a class="anchor" aria-label="anchor" href="#sample-size-calculation---dc-ss-analytical"></a>
</h4>
<p>Now, find the sample size needed for 80% power, truncating at 10
years (120 months).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss_dc_mgus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DC.ss.analytical.html">DC.ss.analytical</a></span><span class="op">(</span></span>
<span>   pilot_data <span class="op">=</span> <span class="va">mgus_prepared</span>,</span>
<span>   time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>   status_var <span class="op">=</span> <span class="st">"event_primary"</span>,</span>
<span>   arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>   dep_cens_status_var <span class="op">=</span> <span class="st">"event_dependent"</span>,</span>
<span>   target_power <span class="op">=</span> <span class="fl">0.80</span>,</span>
<span>   linear_terms <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>   tau <span class="op">=</span> <span class="fl">120</span>, <span class="co"># 10 years</span></span>
<span>   n_start <span class="op">=</span> <span class="fl">100</span>, n_step <span class="op">=</span> <span class="fl">50</span>, max_n_per_arm <span class="op">=</span> <span class="fl">5000</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="interactive-shiny-application">Interactive Shiny Application<a class="anchor" aria-label="anchor" href="#interactive-shiny-application"></a>
</h2>
<p>For users who prefer a graphical interface, <code>RMSTSS</code>
provides an interactive Shiny web application that offers a
point-and-click interface to all the models and methods described in
this vignette.</p>
<div class="section level4">
<h4 id="accessing-the-application">Accessing the Application<a class="anchor" aria-label="anchor" href="#accessing-the-application"></a>
</h4>
<p>There are two ways to access the application:</p>
<ol style="list-style-type: decimal">
<li>
<p><strong>Live Web Version (Recommended)</strong>: Access the
application directly in your browser without any installation.</p>
<ul>
<li><a href="https://arnab96.shinyapps.io/uthsc-app/" class="external-link">Launch Web
Application</a></li>
</ul>
</li>
<li><p><strong>Run Locally from the R Package</strong>: If you have
installed the <code>RMSTSS-Package</code>, you can run the application
on your own machine with the following command:</p></li>
</ol>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">RMSTSS</span><span class="fu">::</span><span class="fu"><a href="../reference/run_app.html">run_app</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="app-features">App Features<a class="anchor" aria-label="anchor" href="#app-features"></a>
</h4>
<ul>
<li>
<strong>Interactive Data Upload</strong>: Upload your pilot dataset
in <code>.csv</code> format.</li>
<li>
<strong>Visual Column Mapping</strong>: Visually map the columns in
your data to the required variables for the analysis (e.g., time,
status, treatment arm).</li>
<li>
<strong>Full Model Selection</strong>: Choose the desired RMST
model, calculation method (analytical or bootstrap), and set all
relevant parameters through user-friendly controls.</li>
<li>
<strong>Rich Visualization</strong>: Execute the analysis and view
the results, including survival plots, power curves, and summary tables,
all within the application.</li>
<li>
<strong>Downloadable Reports</strong>: Generate and download a
complete, publication-ready analysis report in PDF format.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The <code>RMSTSS</code> package provides a powerful and flexible
suite of tools for designing and analyzing clinical trials using the
Restricted Mean Survival Time.</p>
<div class="section level3">
<h3 id="advantages-and-disadvantages">Advantages and Disadvantages<a class="anchor" aria-label="anchor" href="#advantages-and-disadvantages"></a>
</h3>
<ul>
<li>
<strong>Advantages</strong>: The package implements a wide range of
modern statistical methods, allowing users to handle complex scenarios
like stratification, non-linear effects, and competing risks. The
provision of both fast analytical methods and robust bootstrap methods
gives users a choice between speed and distributional flexibility.</li>
<li>
<strong>Disadvantages</strong>: The primary limitation is the
reliance on representative pilot data. The accuracy of any power or
sample size calculation is contingent on the effect sizes and variance
structures estimated from the pilot dataset. Furthermore, the
bootstrap-based methods can be computationally intensive and may require
access to parallel computing resources for timely results.</li>
</ul>
</div>
<div class="section level3">
<h3 id="future-work">Future Work<a class="anchor" aria-label="anchor" href="#future-work"></a>
</h3>
<p>Future development could involve extending the bootstrap approach to
the dependent censoring models and incorporating more advanced model
diagnostic tools to help users assess the adequacy of their chosen model
based on the pilot data.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>```</p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-royston2013" class="csl-entry">
Royston, Patrick, and Mahesh KB Parmar. 2013. <span>“Restricted Mean
Survival Time: An Alternative to the Hazard Ratio for the Design and
Analysis of Randomized Trials with a Time-to-Event Outcome.”</span>
<em>BMC Medical Research Methodology</em> 13 (1): 1–13.
</div>
<div id="ref-tian2014" class="csl-entry">
Tian, Lu, Lihui Zhao, and LJ Wei. 2014. <span>“Predicting the Restricted
Mean Event Time with the Subject’s Baseline Covariates in Survival
Analysis.”</span> <em>Biostatistics</em> 15 (2): 222–33.
</div>
<div id="ref-uno2014" class="csl-entry">
Uno, Hajime, Brian Claggett, Lu Tian, Eisuke Inoue, P-Ralph Gallo, Tomoo
Miyata, Deborah Schrag, et al. 2014. <span>“Moving Beyond the Hazard
Ratio in Quantifying the Between-Group Difference in Survival
Analysis.”</span> <em>Journal of Clinical Oncology</em> 32 (22): 2380.
</div>
<div id="ref-wang2018" class="csl-entry">
Wang, Xin, and Douglas E Schaubel. 2018. <span>“Modeling Restricted Mean
Survival Time Under General Censoring Mechanisms.”</span> <em>Lifetime
Data Analysis</em> 24: 176–99.
</div>
<div id="ref-wang2019" class="csl-entry">
Wang, Xin, Yingchao Zhong, Purna Mukhopadhyay, and Douglas E Schaubel.
2019. <span>“Computationally Efficient Inference for Center Effects
Based on Restricted Mean Survival Time.”</span> <em>Statistics in
Medicine</em> 38 (27): 5133–45.
</div>
<div id="ref-zhang2024" class="csl-entry">
Zhang, Yuan, and Douglas E Schaubel. 2024. <span>“Semiparametric
Additive Modeling of the Restricted Mean Survival Time.”</span>
<em>Biometrical Journal</em> 66 (6): e202200371.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Arnab Aich.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
