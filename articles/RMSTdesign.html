<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>RMSTdesign: Sample Size and Power Calculations for RMST-based Clinical Trials • RMSTdesign</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="RMSTdesign: Sample Size and Power Calculations for RMST-based Clinical Trials">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RMSTdesign</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/RMSTdesign.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>RMSTdesign: Sample Size and Power Calculations for RMST-based Clinical Trials</h1>
                        <h4 data-toc-skip class="author">Arnab Aich</h4>
            
      

      <div class="d-none name"><code>RMSTdesign.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The analysis of time-to-event data has traditionally been dominated
by the Cox proportional hazards model, which focuses on the hazard ratio
(HR) as the primary measure of treatment effect. However, the HR can be
difficult to interpret, especially when the proportional hazards
assumption is violated <span class="citation">Zhang and Schaubel (<a href="#ref-zhang2024">2024</a>)</span>. In such cases, the estimated HR
becomes a weighted average that depends on the study’s specific
censoring pattern, making it difficult to compare results across trials
<span class="citation">(<a href="#ref-wang2018">Wang and Schaubel
2018</a>)</span>. The Restricted Mean Survival Time (RMST) has emerged
as a robust and clinically intuitive alternative, a conclusion supported
by a growing body of literature that advocates for its use in the design
and analysis of clinical trials <span class="citation">Uno et al. (<a href="#ref-uno2014">2014</a>)</span>. The RMST is the average event-free
time up to a pre-specified time point,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
, and is estimated as the area under the survival curve. This provides a
direct measure of survival benefit in units of time (e.g., “days” or
“months”), which is often more meaningful to clinicians and
patients.</p>
<p>Instead of estimating RMST indirectly from a survival function,
recent methodological advances have focused on modeling the RMST
directly as a function of covariates. A foundational paper by <span class="citation">(<a href="#ref-tian2014">Tian, Zhao, and Wei
2014</a>)</span> established a class of such models using Inverse
Probability of Censoring Weighting (IPCW), which provided the
theoretical basis for direct RMST regression. Since then, the literature
has rapidly expanded to adapt this direct modeling approach to the
complex data structures seen in modern trials. Research has moved beyond
a single timepoint to modeling the entire RMST curve as a function of
restriction time <span class="citation">Zhong and Schaubel (<a href="#ref-zhong2022">2022</a>)</span>. Furthermore, to handle the
common challenge of adjusting for high-dimensional categorical variables
like clinical centers, computationally efficient stratified models were
developed, including a multiplicative model by <span class="citation">(<a href="#ref-wang2019">Wang et al. 2019</a>)</span>
and a complementary additive model by <span class="citation">(<a href="#ref-zhang2024">Zhang and Schaubel 2024</a>)</span>. For
observational data, these methods have been extended to estimate causal
effects <span class="citation">(<a href="#ref-ni2021">Ni, Lin, and Lu
2021</a>)</span>, and for settings with competing risks, such as
transplantation studies, <span class="citation">(<a href="#ref-wang2018">Wang and Schaubel 2018</a>)</span> developed a
framework to handle dependent censoring using cause-specific
weights.</p>
<p>To date, the computational implementation of these sophisticated
methods has focused primarily on estimation. For instance, the original
papers describe how estimation can be achieved through custom-coded
procedures or by cleverly manipulating standard software for weighted
least squares or Cox regression <span class="citation">Zhang and
Schaubel (<a href="#ref-zhang2024">2024</a>)</span>. However, there is a
significant gap between these theoretical estimation frameworks and the
availability of validated, user-friendly tools for study design.
Calculating the required sample size or statistical power for a trial
based on these advanced RMST models is a complex task that, until now,
would require bespoke simulation programming from trial
statisticians.</p>
<p>This package, RMSTdesign, is designed to fill that critical gap. The
primary goal of RMSTdesign is to provide trialists with a comprehensive
and accessible suite of tools for power and sample size calculations
based on the very latest in direct RMST methodology. It operationalizes
the seminal work on direct RMST modeling into a set of validated
functions, allowing researchers to robustly design trials for a wide
variety of scenarios. RMSTdesign provides a comprehensive framework by
implementing several key methodologies from the statistical literature:
<code>RMSTdesign</code> provides a comprehensive framework by
implementing several key methodologies from the statistical
literature:</p>
<ul>
<li>
<strong>Direct Linear Models</strong>: Based on the seminal work of
<span class="citation">(<a href="#ref-tian2014">Tian, Zhao, and Wei
2014</a>)</span>, these functions model the RMST directly using Inverse
Probability of Censoring Weighting (IPCW).</li>
<li>
<strong>Stratified Models</strong>: For studies with nuisance
categorical variables (e.g., clinical centers), we provide functions for
both <strong>additive</strong> <span class="citation">(<a href="#ref-zhang2024">Zhang and Schaubel 2024</a>)</span> and
<strong>multiplicative</strong> (<span class="citation">(<a href="#ref-wang2019">Wang et al. 2019</a>)</span>) models, which
efficiently handle stratification without estimating parameters for each
level.</li>
<li>
<strong>Dependent Censoring Models</strong>: In settings with
competing risks, such as transplantation studies where receiving an
organ dependently censors death, we implement methods from <span class="citation">(<a href="#ref-wang2019">Wang et al.
2019</a>)</span>.</li>
<li>
<strong>Flexible Non-Linear Models</strong>: For covariates with
suspected non-linear effects, the package includes bootstrap-based
functions using Generalized Additive Models (GAMs) on
pseudo-observations.</li>
<li>
<strong>Analytic vs. Bootstrap Methods</strong>: For many models,
the package offers both an <code>analytical</code> approach for rapid
calculations and a <code>boot</code> (bootstrap) approach for enhanced
robustness at the cost of computation time.</li>
</ul>
<p>This vignette will guide you through the theory and application of
each of these function groups.</p>
</div>
<div class="section level2">
<h2 id="linear-ipcw-models">Linear IPCW Models<a class="anchor" aria-label="anchor" href="#linear-ipcw-models"></a>
</h2>
<p>These models assume a direct linear relationship between covariates
and the RMST. They are the foundational models for direct RMST
regression when dealing with independent censoring.</p>
<div class="section level3">
<h3 id="theory-and-model">Theory and Model<a class="anchor" aria-label="anchor" href="#theory-and-model"></a>
</h3>
<p>Based on the methods of <span class="citation">(<a href="#ref-tian2014">Tian, Zhao, and Wei 2014</a>)</span>, these
functions model the conditional RMST as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>η</mi><mo stretchy="false" form="prefix">{</mo><mi>μ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo><mo>=</mo><mi>β</mi><mi>′</mi><mi>X</mi></mrow><annotation encoding="application/x-tex">\eta\{\mu(Z)\} = \beta'X</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>η</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>⋅</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\eta(\cdot)</annotation></semantics></math>
is a link function. To account for right-censoring, the method uses
Inverse Probability of Censoring Weighting (IPCW). The weight for an
uncensored individual is the inverse of the probability of remaining
uncensored up to their event time, where this probability is estimated
from a Kaplan-Meier curve of the censoring distribution.</p>
</div>
<div class="section level3">
<h3 id="analytical-methods">Analytical Methods<a class="anchor" aria-label="anchor" href="#analytical-methods"></a>
</h3>
<p>The analytical functions use a formula based on the asymptotic
variance of the regression coefficients to calculate power or sample
size, making them extremely fast.</p>
<p><strong>Scenario</strong>: We use the <code>veteran</code> dataset to
estimate power for a trial comparing standard vs. test chemotherapy
(<code>trt</code>), adjusting for the Karnofsky performance score
(<code>karno</code>).</p>
<div class="section level4">
<h4 id="power-calculation---linear-power-analytical">Power Calculation - <a href="../reference/linear.power.analytical.html"><code>linear.power.analytical</code></a><a class="anchor" aria-label="anchor" href="#power-calculation---linear-power-analytical"></a>
</h4>
<p>First, let’s inspect the prepared <code>veteran</code> dataset.</p>
<p>Now, we calculate the power for a range of sample sizes using a
truncation time of 9 months year (270 days).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_results_vet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linear.power.analytical.html">linear.power.analytical</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">vet</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  linear_terms <span class="op">=</span> <span class="st">"karno"</span>,</span>
<span>  sample_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">150</span>, <span class="fl">200</span>, <span class="fl">250</span><span class="op">)</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">270</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The results are returned as a data frame and a <code>ggplot</code>
object.</p>
</div>
<div class="section level4">
<h4 id="sample-size-calculation---linear-ss-analytical">Sample Size Calculation - <a href="../reference/linear.ss.analytical.html"><code>linear.ss.analytical</code></a><a class="anchor" aria-label="anchor" href="#sample-size-calculation---linear-ss-analytical"></a>
</h4>
<p>We can also use the analytical method to find the required sample
size to achieve a target power for a truncation time of an year(365
days) .</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss_results_vet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linear.ss.analytical.html">linear.ss.analytical</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">vet</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.40</span>,</span>
<span>  linear_terms <span class="op">=</span> <span class="st">"karno"</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  n_start <span class="op">=</span> <span class="fl">1000</span>, n_step <span class="op">=</span> <span class="fl">250</span>, max_n_per_arm <span class="op">=</span> <span class="fl">5000</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="bootstrap-methods">Bootstrap Methods<a class="anchor" aria-label="anchor" href="#bootstrap-methods"></a>
</h3>
<p>The bootstrap, or simulation-based, approach provides a robust,
distribution-free alternative. The <code>.boot</code> suffix in the
function names is shorthand for ‘bootstrap simulation’. This method
repeatedly resamples from the pilot data, fits the model on each sample,
and calculates power as the proportion of simulations where the
treatment effect is significant. While computationally intensive, it
makes fewer assumptions.</p>
<div class="section level4">
<h4 id="power-and-sample-size-calculation--boot">Power and Sample Size Calculation (<code>.boot</code>)<a class="anchor" aria-label="anchor" href="#power-and-sample-size-calculation--boot"></a>
</h4>
<p>Here is how you would call the bootstrap functions for power for the
linear model. The following examples use the same <code>veteran</code>
dataset, but with a smaller number of simulations for demonstration
purposes. In practice, you would use a larger number of simulations
(e.g., 1000 or more) to ensure stability of the results.</p>
<p>First we calculate the power for a range of sample sizes. The <a href="../reference/linear.power.boot.html"><code>linear.power.boot</code></a>
function takes the pilot data and returns a data frame with the
estimated power for each sample size.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_boot_vet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linear.power.boot.html">linear.power.boot</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">vet</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  linear_terms <span class="op">=</span> <span class="st">"karno"</span>,</span>
<span>  sample_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">200</span>, <span class="fl">250</span><span class="op">)</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">200</span> </span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here is how you would call the bootstrap function for sample size
calculation. We will use the function <a href="../reference/linear.ss.boot.html"><code>linear.ss.boot</code></a>
to find the sample size needed to achieve a target power of 0.5,
truncating at 180 days (6 months).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss_boot_vet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linear.ss.boot.html">linear.ss.boot</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">vet</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  linear_terms <span class="op">=</span> <span class="st">"karno"</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">180</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span>, </span>
<span>  patience <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="additive-stratified-models">Additive Stratified Models<a class="anchor" aria-label="anchor" href="#additive-stratified-models"></a>
</h2>
<p>In many trials, it is necessary to stratify by a categorical variable
with many levels, such as clinical center or a discretized biomarker.
Estimating a separate parameter for each stratum is inefficient. The
additive stratified model elegantly handles this by conditioning out the
stratum effect.</p>
<div class="section level3">
<h3 id="theory-and-model-1">Theory and Model<a class="anchor" aria-label="anchor" href="#theory-and-model-1"></a>
</h3>
<p>The semiparametric additive model for RMST,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>μ</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><mo>+</mo><mi>β</mi><mi>′</mi><msub><mi>Z</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\mu_{ij} = \mu_{0j} + \beta'Z_i</annotation></semantics></math>,
assumes that the effect of covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Z_i</annotation></semantics></math>
is additive and constant across strata
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
while allowing each stratum to have its own baseline RMST,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{0j}</annotation></semantics></math>.
The methods implemented here are based on Zhang &amp; Schaubel (2024),
who show that the common effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
can be estimated efficiently by using a stratum-centering approach on
the IPCW-weighted data, which avoids direct estimation of the numerous
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{0j}</annotation></semantics></math>
parameters.</p>
</div>
<div class="section level3">
<h3 id="analytical-methods-1">Analytical Methods<a class="anchor" aria-label="anchor" href="#analytical-methods-1"></a>
</h3>
<div class="section level4">
<h4 id="sample-size-calculation---additive-ss-analytical">Sample Size Calculation - <a href="../reference/additive.ss.analytical.html"><code>additive.ss.analytical</code></a><a class="anchor" aria-label="anchor" href="#sample-size-calculation---additive-ss-analytical"></a>
</h4>
<p><strong>Scenario</strong>: We use the <code>colon</code> dataset to
design a trial stratified by the extent of local disease
(<code>extent</code>), a factor with 4 levels. We want to find the
sample size per stratum to achieve 80% power. Let’s inspect the prepared
<code>colon</code> dataset.</p>
<p>Now, we run the sample size search for 80% power, truncating at 5
years (1825 days).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss_results_colon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/additive.ss.analytical.html">additive.ss.analytical</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">colon_death</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>, status_var <span class="op">=</span> <span class="st">"status"</span>, arm_var <span class="op">=</span> <span class="st">"arm"</span>, strata_var <span class="op">=</span> <span class="st">"strata"</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.60</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">1825</span>,</span>
<span>  n_start <span class="op">=</span> <span class="fl">100</span>, n_step <span class="op">=</span> <span class="fl">100</span>, max_n_per_arm <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="power-calculation---additive-power-analytical">Power Calculation - <a href="../reference/additive.power.analytical.html"><code>additive.power.analytical</code></a><a class="anchor" aria-label="anchor" href="#power-calculation---additive-power-analytical"></a>
</h4>
<p>This function calculates the power for a given set of sample sizes in
a stratified additive model. We will use the <code>colon</code> dataset
again for this example.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate power for a range of sample sizes per stratum</span></span>
<span><span class="va">power_results_colon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/additive.power.analytical.html">additive.power.analytical</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">colon_death</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  strata_var <span class="op">=</span> <span class="st">"strata"</span>,</span>
<span>  sample_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">3000</span>, <span class="fl">5000</span><span class="op">)</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">1825</span> <span class="co"># 5 years</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="multiplicative-stratified-models">Multiplicative Stratified Models<a class="anchor" aria-label="anchor" href="#multiplicative-stratified-models"></a>
</h2>
<p>As an alternative to the additive model, the multiplicative model may
be preferred if the treatment is expected to have a relative effect on
the RMST, such as increasing or decreasing survival time by a certain
percentage.</p>
<div class="section level3">
<h3 id="theory-and-model-2">Theory and Model<a class="anchor" aria-label="anchor" href="#theory-and-model-2"></a>
</h3>
<p>The multiplicative model is of the form
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>μ</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>β</mi><mi>′</mi><msub><mi>Z</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu_{ij} = \mu_{0j} \exp(\beta'Z_i)</annotation></semantics></math>,
where the effect of covariates is a proportional change to the baseline
stratum-specific RMST. This is particularly useful for facility
profiling, where we might have thousands of centers. The methods
implemented here, based on <span class="citation">(<a href="#ref-wang2019">Wang et al. 2019</a>)</span>, use a computationally
efficient two-stage procedure that avoids creating thousands of
indicator variables, making analysis of very large datasets
feasible.</p>
</div>
<div class="section level3">
<h3 id="analytical-methods-2">Analytical Methods<a class="anchor" aria-label="anchor" href="#analytical-methods-2"></a>
</h3>
<div class="section level4">
<h4 id="power-calculation---ms-power-analytical">Power Calculation - <a href="../reference/MS.power.analytical.html"><code>MS.power.analytical</code></a><a class="anchor" aria-label="anchor" href="#power-calculation---ms-power-analytical"></a>
</h4>
<p>This function calculates the power for various sample sizes using the
analytical method for the multiplicative stratified model.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate power using the multiplicative stratified analytical method</span></span>
<span><span class="va">power_ms_analytical</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MS.power.analytical.html">MS.power.analytical</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">colon_death</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>, status_var <span class="op">=</span> <span class="st">"status"</span>, arm_var <span class="op">=</span> <span class="st">"arm"</span>, strata_var <span class="op">=</span> <span class="st">"strata"</span>,</span>
<span>  sample_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">400</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">1825</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sample-size-calculation---ms-ss-analytical">Sample Size Calculation - <a href="../reference/MS.ss.analytical.html"><code>MS.ss.analytical</code></a><a class="anchor" aria-label="anchor" href="#sample-size-calculation---ms-ss-analytical"></a>
</h4>
<p>The following example demonstrates the sample size calculation using
the same model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate sample size</span></span>
<span><span class="va">ms_ss_results_colon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MS.ss.analytical.html">MS.ss.analytical</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">colon_death</span>, time_var <span class="op">=</span> <span class="st">"time"</span>, status_var <span class="op">=</span> <span class="st">"status"</span>, arm_var <span class="op">=</span> <span class="st">"arm"</span>, strata_var <span class="op">=</span> <span class="st">"strata"</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.6</span>,tau <span class="op">=</span> <span class="fl">1825</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="bootstrap-methods-1">Bootstrap Methods<a class="anchor" aria-label="anchor" href="#bootstrap-methods-1"></a>
</h3>
<p>The bootstrap approach provides a more robust, simulation-based
analysis for the multiplicative model.</p>
<div class="section level4">
<h4 id="power-calculation---ms-power-boot">Power Calculation - <a href="../reference/MS.power.boot.html"><code>MS.power.boot</code></a><a class="anchor" aria-label="anchor" href="#power-calculation---ms-power-boot"></a>
</h4>
<p>The following code demonstrates how to call the
<code>MS.power.boot</code> function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_ms_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MS.power.boot.html">MS.power.boot</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">colon_death</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  strata_var <span class="op">=</span> <span class="st">"strata"</span>,</span>
<span>  sample_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">300</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">1825</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">100</span>, </span>
<span>  parallel.cores <span class="op">=</span> <span class="fl">10</span> </span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sample-size-calculation---ms-ss-boot">Sample Size Calculation - <a href="../reference/MS.ss.boot.html"><code>MS.ss.boot</code></a><a class="anchor" aria-label="anchor" href="#sample-size-calculation---ms-ss-boot"></a>
</h4>
<p>Similarly, the sample size can be calculated using bootstrap
simulation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss_ms_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MS.ss.boot.html">MS.ss.boot</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">colon_death</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  strata_var <span class="op">=</span> <span class="st">"strata"</span>, </span>
<span>  target_power <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">1825</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_start <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_step <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  patience <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  parallel.cores <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="semiparametric-gam-models">Semiparametric GAM Models<a class="anchor" aria-label="anchor" href="#semiparametric-gam-models"></a>
</h2>
<p>When a covariate is expected to have a non-linear effect on the
outcome, standard linear models may be misspecified. Generalized
Additive Models (GAMs) provide a flexible solution.</p>
<div class="section level3">
<h3 id="theory-and-model-3">Theory and Model<a class="anchor" aria-label="anchor" href="#theory-and-model-3"></a>
</h3>
<p>These functions use a bootstrap simulation approach combined with a
GAM. The time-to-event outcome is first converted into <strong>jackknife
pseudo-observations</strong> for the RMST. A GAM is then fitted to these
pseudo-observations, allowing for smooth, non-linear functions of
specified covariates using <code>s()</code> terms from the
<code>mgcv</code> package. This approach is powerful but computationally
intensive.</p>
</div>
<div class="section level3">
<h3 id="bootstrap-methods-2">Bootstrap Methods<a class="anchor" aria-label="anchor" href="#bootstrap-methods-2"></a>
</h3>
<div class="section level4">
<h4 id="power-calculation---gam-power-boot">Power Calculation - <a href="../reference/GAM.power.boot.html"><code>GAM.power.boot</code></a><a class="anchor" aria-label="anchor" href="#power-calculation---gam-power-boot"></a>
</h4>
<p><strong>Scenario</strong>: We use the <code>gbsg</code> (German
Breast Cancer Study Group) dataset, suspecting that the progesterone
receptor count (<code>pgr</code>) has a non-linear effect on
recurrence-free survival. Here is a look at the prepared
<code>gbsg</code> data.</p>
<p>The following code shows how to calculate power.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GAM.power.boot.html">GAM.power.boot</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">gbsg_prepared</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"rfstime"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  smooth_terms <span class="op">=</span> <span class="st">"pgr"</span>, <span class="co"># Model pgr with a smooth term</span></span>
<span>  sample_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">200</span>, <span class="fl">400</span><span class="op">)</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">2825</span>, <span class="co"># 5 years</span></span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  parallel.cores <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">power_gam</span><span class="op">$</span><span class="va">results_plot</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sample-size-calculation---gam-ss-boot">Sample Size Calculation - <a href="../reference/GAM.ss.boot.html"><code>GAM.ss.boot</code></a><a class="anchor" aria-label="anchor" href="#sample-size-calculation---gam-ss-boot"></a>
</h4>
<p><strong>Scenario</strong>: We want to find the sample size needed to
achieve 80% power for detecting an effect of <code>pgr</code> on
recurrence-free survival.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GAM.ss.boot.html">GAM.ss.boot</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">gbsg_prepared</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"rfstime"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">182</span>, </span>
<span>  n_sim <span class="op">=</span> <span class="fl">500</span>, </span>
<span>  patience <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  parallel.cores <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="dependent-censoring-models">Dependent Censoring Models<a class="anchor" aria-label="anchor" href="#dependent-censoring-models"></a>
</h2>
<p>In some studies, particularly observational or registry studies,
censoring may not be independent of the event of interest. A classic
example is in transplant medicine, where receiving an organ (a “good”
event) removes a patient from being at risk of pre-transplant death.
This is a form of competing risk, or dependent censoring.</p>
<div class="section level3">
<h3 id="theory-and-model-4">Theory and Model<a class="anchor" aria-label="anchor" href="#theory-and-model-4"></a>
</h3>
<p>The methods from <span class="citation">(<a href="#ref-wang2019">Wang
et al. 2019</a>)</span> address this by extending the IPCW framework.
Instead of a single censoring model, <strong>cause-specific Cox
models</strong> are fitted for each source of censoring (e.g., one model
for administrative censoring, another for the competing event). The
final weight for a subject is a product of the weights derived from all
censoring causes, allowing for unbiased estimation of the RMST for the
primary event. We will use the <code>mgus2</code> dataset for this
scenario.</p>
</div>
<div class="section level3">
<h3 id="analytical-methods-3">Analytical Methods<a class="anchor" aria-label="anchor" href="#analytical-methods-3"></a>
</h3>
<div class="section level4">
<h4 id="power-calculation---dc-power-analytical">Power Calculation - <a href="../reference/DC.power.analytical.html"><code>DC.power.analytical</code></a><a class="anchor" aria-label="anchor" href="#power-calculation---dc-power-analytical"></a>
</h4>
<p>This function calculates power for a study with dependent censoring
(competing risks) for a given set of sample sizes.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dc_power_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DC.power.analytical.html">DC.power.analytical</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">mgus_prepared</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"event_primary"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  dep_cens_status_var <span class="op">=</span> <span class="st">"event_dependent"</span>,</span>
<span>  sample_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">250</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>  linear_terms <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">120</span> <span class="co"># 10 years</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sample-size-calculation---dc-ss-analytical">Sample Size Calculation - <a href="../reference/DC.ss.analytical.html"><code>DC.ss.analytical</code></a><a class="anchor" aria-label="anchor" href="#sample-size-calculation---dc-ss-analytical"></a>
</h4>
<p>Now, find the sample size needed for 80% power, truncating at 10
years (120 months).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss_dc_mgus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DC.ss.analytical.html">DC.ss.analytical</a></span><span class="op">(</span></span>
<span>  pilot_data <span class="op">=</span> <span class="va">mgus_prepared</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"event_primary"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  dep_cens_status_var <span class="op">=</span> <span class="st">"event_dependent"</span>,</span>
<span>  target_power <span class="op">=</span> <span class="fl">0.80</span>,</span>
<span>  linear_terms <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">120</span>, <span class="co"># 10 years</span></span>
<span>  n_start <span class="op">=</span> <span class="fl">100</span>, n_step <span class="op">=</span> <span class="fl">50</span>, max_n_per_arm <span class="op">=</span> <span class="fl">5000</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The <code>RMSTdesign</code> package provides a powerful and flexible
suite of tools for designing and analyzing clinical trials using the
Restricted Mean Survival Time.</p>
<div class="section level3">
<h3 id="advantages-and-disadvantages">Advantages and Disadvantages<a class="anchor" aria-label="anchor" href="#advantages-and-disadvantages"></a>
</h3>
<ul>
<li>
<strong>Advantages</strong>: The package implements a wide range of
modern statistical methods, allowing users to handle complex scenarios
like stratification, non-linear effects, and competing risks. The
provision of both fast analytical methods and robust bootstrap methods
gives users a choice between speed and distributional flexibility.</li>
<li>
<strong>Disadvantages</strong>: The primary limitation is the
reliance on representative pilot data. The accuracy of any power or
sample size calculation is contingent on the effect sizes and variance
structures estimated from the pilot dataset. Furthermore, the
bootstrap-based methods can be computationally intensive and may require
access to parallel computing resources for timely results.</li>
</ul>
</div>
<div class="section level3">
<h3 id="future-work">Future Work<a class="anchor" aria-label="anchor" href="#future-work"></a>
</h3>
<p>Future development could involve extending the bootstrap approach to
the dependent censoring models and incorporating more advanced model
diagnostic tools to help users assess the adequacy of their chosen model
based on the pilot data.</p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-ni2021" class="csl-entry">
Ni, Ao, Zhaohua Lin, and Bo Lu. 2021. <span>“Stratified Restricted Mean
Survival Time Model for Marginal Causal Effect in Observational Survival
Data.”</span> <em>Annals of Epidemiology</em> 64: 149–54.
</div>
<div id="ref-royston2013" class="csl-entry">
Royston, Patrick, and Mahesh KB Parmar. 2013. <span>“Restricted Mean
Survival Time: An Alternative to the Hazard Ratio for the Design and
Analysis of Randomized Trials with a Time-to-Event Outcome.”</span>
<em>BMC Medical Research Methodology</em> 13 (1): 1–13.
</div>
<div id="ref-tian2014" class="csl-entry">
Tian, Lu, Lihui Zhao, and LJ Wei. 2014. <span>“Predicting the Restricted
Mean Event Time with the Subject’s Baseline Covariates in Survival
Analysis.”</span> <em>Biostatistics</em> 15 (2): 222–33.
</div>
<div id="ref-uno2014" class="csl-entry">
Uno, Hajime, Brian Claggett, Lu Tian, Eisuke Inoue, P-Ralph Gallo, Tomoo
Miyata, Deborah Schrag, et al. 2014. <span>“Moving Beyond the Hazard
Ratio in Quantifying the Between-Group Difference in Survival
Analysis.”</span> <em>Journal of Clinical Oncology</em> 32 (22): 2380.
</div>
<div id="ref-wang2018" class="csl-entry">
Wang, Xin, and Douglas E Schaubel. 2018. <span>“Modeling Restricted Mean
Survival Time Under General Censoring Mechanisms.”</span> <em>Lifetime
Data Analysis</em> 24: 176–99.
</div>
<div id="ref-wang2019" class="csl-entry">
Wang, Xin, Yingchao Zhong, Purna Mukhopadhyay, and Douglas E Schaubel.
2019. <span>“Computationally Efficient Inference for Center Effects
Based on Restricted Mean Survival Time.”</span> <em>Statistics in
Medicine</em> 38 (27): 5133–45.
</div>
<div id="ref-zhang2024" class="csl-entry">
Zhang, Yuan, and Douglas E Schaubel. 2024. <span>“Semiparametric
Additive Modeling of the Restricted Mean Survival Time.”</span>
<em>Biometrical Journal</em> 66 (6): e202200371.
</div>
<div id="ref-zhao2016" class="csl-entry">
Zhao, Lihui, Brian Claggett, Lu Tian, Hajime Uno, Marc A Pfeffer, Scott
D Solomon, and LJ Wei. 2016. <span>“On the Restricted Mean Survival Time
Curve in Survival Analysis.”</span> <em>Biometrics</em> 72 (1): 215–21.
</div>
<div id="ref-zhong2022" class="csl-entry">
Zhong, Yingchao, and Douglas E Schaubel. 2022. <span>“Restricted Mean
Survival Time as a Function of Restriction Time.”</span>
<em>Biometrics</em> 78 (1): 192–201.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Arnab Aich.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
